{"mappings":"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","sources":["/mnt/c/WebXR/utopic-estudios/node_modules/@parcel/scope-hoisting/lib/helpers.js","node_modules/@parcel/runtime-js/lib/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/JSRuntime.js","node_modules/@parcel/runtime-js/lib/bundle-url.js","node_modules/@parcel/runtime-js/lib/relative-path.js","src/logic/lcdm.js"],"names":["$parcel$interopDefault","a","__esModule","default","mapping","id","resolved","Error","pairs","keys","Object","i","length","$bd72ee1865b930c1fed8ae47f35e91$export$register","JSON","parse","bundleURL","err","matches","stack","match","replace","getBundleURL","resolve","$bd72ee1865b930c1fed8ae47f35e91$export$resolve","dirname","_filePath","filePath","slice","slashIndex","lastIndexOf","relative","from","to","fromParts","split","shift","divergeIndex","toParts","parts","push","apply","join","$e5b69ae2ffddc223b376d75aff9c28$exports","fromId","toId","_dirname","_relative","$aa29e196542441d3d4fcdeda68379c3$exports","$da3a6c17234c5d68d4f1108f53a7bad4$export$getBundleURL","$d34483f6e10afec98bdae67208326c9$exports","$ff6b2a691cd763fe34b72580d82ebdb$exports","$e174cafca36189b8574664065e7784$exports","scene","camera","canvas","renderer","grabPoint","$a324c7ab8680f6ddf3c46fa09ec7367$exports","physicsWorld","clock","AmmoLib","tmpTrans","line","directionalLight","cubes","interactable","mouse","THREE","Vector2","raycaster","Raycaster","linePositions","cubeSettings","elem","document","querySelector","pos","x","y","z","rot","Euler","texture","$aa29e196542441d3d4fcdeda68379c3$$interop$default","active","$d34483f6e10afec98bdae67208326c9$$interop$default","$ff6b2a691cd763fe34b72580d82ebdb$$interop$default","$e174cafca36189b8574664065e7784$$interop$default","$a324c7ab8680f6ddf3c46fa09ec7367$$interop$default","planElems","querySelectorAll","getGameXY","bounds","window","pageXOffset","pageYOffset","clientWidth","clientHeight","width","height","zoom","updateCubeSettings","curCube","e","getBoundingClientRect","Vector3","createBound","name","depth","color","friction","arguments","undefined","groundShape","btBoxShape","btVector3","groundTransform","btTransform","setIdentity","setOrigin","localInertia","myMotionState","btDefaultMotionState","rbInfo","btRigidBodyConstructionInfo","body","btRigidBody","setCollisionFlags","setFriction","addRigidBody","geometry","BoxBufferGeometry","object","Mesh","MeshLambertMaterial","scale","set","position","userData","add","removeEntity","selectedObject","getObjectByName","removeRigidBody","remove","CreateBounds","min_x","left","max_x","right","min_y","bottom","max_y","top","w","updateCameraSize","updateProjectionMatrix","updateSize","r","needResize","domElement","setSize","animate","deltaTime","getDelta","time","Date","now","Math","cos","obj","physicsBody","transform","getCenterOfMassTransform","min","max","setCenterOfMassTransform","ClampPositions","constraint","first_time","ga","hitType","eventCategory","eventAction","_v$unproject2","unproject","grabPointPos","setFromMatrixPosition","matrixWorld","attributes","needsUpdate","computeBoundingSphere","visible","setGravity","gravity","stepSimulation","objThree","ms","getMotionState","getWorldTransform","p","getOrigin","q","getRotation","quaternion","updatePhysics","solved","frame_counter","force","random","v","normalize","multiplyScalar","_ref","vx","vy","vz","activate","applyCentralImpulse","fluidsMovePointers","PreparePointers","gameBounds","trySol","cube","sort","b","proposedSol","map","toString","CheckSolution","PlaySolvedMagic","render","requestAnimationFrame","addEventListener","Ammo","then","ammo","collisionConfiguration","dispatcher","overlappingPairCache","solver","btDefaultCollisionConfiguration","btCollisionDispatcher","btDbvtBroadphase","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","Clock","getElementById","WebGLRenderer","alpha","shadowMap","enabled","type","PCFSoftShadowMap","OrthographicCamera","Scene","AmbientLight","DirectionalLight","castShadow","shadow","clone","mapSize","input","pixelRatio","lineGeometry","BufferGeometry","Float32Array","setAttribute","BufferAttribute","setDrawRange","Line","LineBasicMaterial","linewidth","devicePixelRatio","floor","planeMaterial","planeGeometry","crystal","createCube","quat","mass","textureUrl","TextureLoader","load","setRotation","btQuaternion","motionState","colShape","calculateLocalInertia","forceActivationState","SphereGeometry","config","Quaternion","setFromEuler","size","domElem","MeshBasicMaterial","opacity","transparent","PlaneBufferGeometry","createShadowPlane","rotation","ShadowMaterial","plane","copy","receiveShadow","shadowPlane","createAndAddShadowPlanes","lastWidth","innerWidth","RT","clearTimeout","setTimeout","location","reload","onMouseMove","onMouseDown","passive","onMouseCancel","init","pickedBody","intersection","event","updateMouse","updateIntersection","preventDefault","inter","localPoint","worldToLocal","point","localPivot","btPoint2PointConstraint","addConstraint","m_setting","m_impulseClamp","m_tau","parent","removeConstraint","setActivationState","touchEv","touches","changedTouchEv","changedTouches","touch","documentBounds","documentElement","pageX","pageY","nonPageX","clientX","nonPageY","clientY","setFromCamera","newIntersections","intersectObjects","startsWith","style","pointerEvents","cursor","_v$unproject","oldPivotInB","getPivotInB","setX","setY","scroll","scrollX","scrollY","solve","cubePointers","identifier","vantabg","destroy","enableFluids","cubesPointers","fluidsStartPointers","burger","classList","contains"],"version":3,"file":"lcdm.5867d14f.js.map","sourcesContent":[null,"\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _plugin = require(\"@parcel/plugin\");\n\nvar _utils = require(\"@parcel/utils\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _nullthrows = _interopRequireDefault(require(\"nullthrows\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// List of browsers that support dynamic import natively\n// https://caniuse.com/#feat=es6-module-dynamic-import\nconst DYNAMIC_IMPORT_BROWSERS = {\n  edge: '76',\n  firefox: '67',\n  chrome: '63',\n  safari: '11.1',\n  opera: '50'\n};\nconst LOADERS = {\n  browser: {\n    css: './loaders/browser/css-loader',\n    html: './loaders/browser/html-loader',\n    js: './loaders/browser/js-loader',\n    wasm: './loaders/browser/wasm-loader',\n    IMPORT_POLYFILL: './loaders/browser/import-polyfill'\n  },\n  worker: {\n    js: './loaders/worker/js-loader',\n    wasm: './loaders/worker/wasm-loader',\n    IMPORT_POLYFILL: false\n  },\n  node: {\n    css: './loaders/node/css-loader',\n    html: './loaders/node/html-loader',\n    js: './loaders/node/js-loader',\n    wasm: './loaders/node/wasm-loader',\n    IMPORT_POLYFILL: null\n  }\n};\n\nfunction getLoaders(ctx) {\n  if (ctx.isWorker()) return LOADERS.worker;\n  if (ctx.isBrowser()) return LOADERS.browser;\n  if (ctx.isNode()) return LOADERS.node;\n  return null;\n}\n\nvar _default = new _plugin.Runtime({\n  apply({\n    bundle,\n    bundleGraph,\n    options\n  }) {\n    // Dependency ids in code replaced with referenced bundle names\n    // Loader runtime added for bundle groups that don't have a native loader (e.g. HTML/CSS/Worker - isURL?),\n    // and which are not loaded by a parent bundle.\n    // Loaders also added for modules that were moved to a separate bundle because they are a different type\n    // (e.g. WASM, HTML). These should be preloaded prior to the bundle being executed. Replace the entry asset(s)\n    // with the preload module.\n    if (bundle.type !== 'js') {\n      return;\n    }\n\n    let asyncDependencies = [];\n    let otherDependencies = [];\n    bundle.traverse(node => {\n      if (node.type !== 'dependency') {\n        return;\n      }\n\n      let dependency = node.value;\n\n      if (dependency.isAsync && !dependency.isURL) {\n        asyncDependencies.push(dependency);\n      } else {\n        otherDependencies.push(dependency);\n      }\n    });\n    let assets = [];\n\n    for (let dependency of asyncDependencies) {\n      let resolved = bundleGraph.resolveExternalDependency(dependency, bundle);\n\n      if (resolved == null) {\n        continue;\n      }\n\n      if (resolved.type === 'asset') {\n        // If this bundle already has the asset this dependency references,\n        // return a simple runtime of `Promise.resolve(require(\"path/to/asset\"))`.\n        assets.push({\n          filePath: _path.default.join(options.projectRoot, 'JSRuntime.js'),\n          // Using Promise['resolve'] to prevent Parcel from inferring this is an async dependency.\n          // TODO: Find a better way of doing this.\n          code: `module.exports = Promise['resolve'](require(${JSON.stringify('./' + _path.default.relative(options.projectRoot, resolved.value.filePath))}))`,\n          dependency\n        });\n      } else {\n        assets.push(...getLoaderRuntimes({\n          bundle,\n          dependency,\n          bundleGraph,\n          bundleGroup: resolved.value\n        }));\n      }\n    }\n\n    for (let dependency of otherDependencies) {\n      let resolved = bundleGraph.resolveExternalDependency(dependency, bundle);\n\n      if (dependency.isURL && resolved == null) {\n        // If a URL dependency was not able to be resolved, add a runtime that\n        // exports the original moduleSpecifier.\n        assets.push({\n          filePath: __filename,\n          code: `module.exports = ${JSON.stringify(dependency.moduleSpecifier)}`,\n          dependency\n        });\n        continue;\n      }\n\n      if (resolved == null || resolved.type !== 'bundle_group') {\n        continue;\n      }\n\n      let bundleGroup = resolved.value;\n      let mainBundle = (0, _nullthrows.default)(bundleGraph.getBundlesInBundleGroup(bundleGroup).find(b => {\n        let main = b.getMainEntry();\n        return main && bundleGroup.entryAssetId === main.id;\n      }));\n\n      if (mainBundle.isInline) {\n        assets.push({\n          filePath: _path.default.join(__dirname, `/bundles/${mainBundle.id}.js`),\n          code: `module.exports = ${JSON.stringify(dependency.id)};`,\n          dependency\n        });\n        continue;\n      } // URL dependency or not, fall back to including a runtime that exports the url\n\n\n      assets.push(getURLRuntime(dependency, bundle, mainBundle));\n    }\n\n    if (shouldUseRuntimeManifest(bundle) && bundleGraph.getChildBundles(bundle).length > 0 && isNewContext(bundle, bundleGraph)) {\n      assets.push({\n        filePath: __filename,\n        code: getRegisterCode(bundle, bundleGraph),\n        isEntry: true\n      });\n    }\n\n    return assets;\n  }\n\n});\n\nexports.default = _default;\n\nfunction getLoaderRuntimes({\n  bundle,\n  dependency,\n  bundleGroup,\n  bundleGraph\n}) {\n  let assets = []; // Sort so the bundles containing the entry asset appear last\n\n  let externalBundles = bundleGraph.getBundlesInBundleGroup(bundleGroup).filter(bundle => !bundle.isInline).sort(bundle => bundle.getEntryAssets().map(asset => asset.id).includes(bundleGroup.entryAssetId) ? 1 : -1); // CommonJS is a synchronous module system, so there is no need to load bundles in parallel.\n  // Importing of the other bundles will be handled by the bundle group entry.\n  // Do the same thing in library mode for ES modules, as we are building for another bundler\n  // and the imports for sibling bundles will be in the target bundle.\n\n  if (bundle.env.outputFormat === 'commonjs' || bundle.env.isLibrary) {\n    externalBundles = externalBundles.slice(-1);\n  }\n\n  let loaders = getLoaders(bundle.env); // Determine if we need to add a dynamic import() polyfill, or if all target browsers support it natively.\n\n  let needsDynamicImportPolyfill = false;\n\n  if (bundle.env.isBrowser() && bundle.env.outputFormat === 'esmodule') {\n    needsDynamicImportPolyfill = !bundle.env.matchesEngines(DYNAMIC_IMPORT_BROWSERS);\n  }\n\n  let loaderModules = loaders ? externalBundles.map(to => {\n    let loader = loaders[to.type];\n\n    if (!loader) {\n      return;\n    }\n\n    let relativePathExpr = getRelativePathExpr(bundle, to); // Use esmodule loader if possible\n\n    if (to.type === 'js' && to.env.outputFormat === 'esmodule') {\n      if (!needsDynamicImportPolyfill) {\n        return `import(\"./\" + ${relativePathExpr})`;\n      }\n\n      loader = (0, _nullthrows.default)(loaders.IMPORT_POLYFILL, `No import() polyfill available for context '${bundle.env.context}'`);\n    } else if (to.type === 'js' && to.env.outputFormat === 'commonjs') {\n      return `Promise.resolve(require(\"./\" + ${relativePathExpr}))`;\n    }\n\n    return `require(${JSON.stringify(loader)})(require('./bundle-url').getBundleURL() + ${relativePathExpr})`;\n  }).filter(Boolean) : [];\n\n  if (loaderModules.length > 0) {\n    let loaders = loaderModules.join(', ');\n\n    if (loaderModules.length > 1 && (bundle.env.outputFormat === 'global' || !externalBundles.every(b => b.type === 'js'))) {\n      loaders = `Promise.all([${loaders}])`;\n\n      if (bundle.env.outputFormat !== 'global') {\n        loaders += `.then(r => r[r.length - 1])`;\n      }\n    } else {\n      loaders = `(${loaders})`;\n    }\n\n    if (bundle.env.outputFormat === 'global') {\n      loaders += `.then(() => parcelRequire('${bundleGroup.entryAssetId}')${// In global output with scope hoisting, functions return exports are\n      // always returned. Otherwise, the exports are returned.\n      bundle.env.scopeHoist ? '()' : ''})`;\n    }\n\n    assets.push({\n      filePath: __filename,\n      code: `module.exports = ${loaders};`,\n      dependency\n    });\n  }\n\n  return assets;\n}\n\nfunction isNewContext(bundle, bundleGraph) {\n  return bundle.isEntry || bundleGraph.getParentBundles(bundle).some(parent => parent.env.context !== bundle.env.context || parent.type !== 'js');\n}\n\nfunction getURLRuntime(dependency, from, to) {\n  let relativePathExpr = getRelativePathExpr(from, to);\n\n  if (dependency.meta.webworker === true) {\n    return {\n      filePath: __filename,\n      code: `module.exports = require('./get-worker-url')(${relativePathExpr});`,\n      dependency\n    };\n  }\n\n  return {\n    filePath: __filename,\n    code: `module.exports = require('./bundle-url').getBundleURL() + ${relativePathExpr}`,\n    dependency\n  };\n}\n\nfunction getRegisterCode(entryBundle, bundleGraph) {\n  let idToName = {};\n  bundleGraph.traverseBundles((bundle, _, actions) => {\n    if (bundle.isInline) {\n      return;\n    }\n\n    idToName[getPublicBundleId(bundle)] = (0, _nullthrows.default)(bundle.name);\n\n    if (bundle !== entryBundle && isNewContext(bundle, bundleGraph)) {\n      // New contexts have their own manifests, so there's no need to continue.\n      actions.skipChildren();\n    }\n  }, entryBundle);\n  return \"require('./bundle-manifest').register(JSON.parse(\" + JSON.stringify(JSON.stringify(idToName)) + '));';\n}\n\nfunction getRelativePathExpr(from, to) {\n  if (shouldUseRuntimeManifest(from)) {\n    return `require('./relative-path')(${JSON.stringify(getPublicBundleId(from))}, ${JSON.stringify(getPublicBundleId(to))})`;\n  }\n\n  return JSON.stringify((0, _utils.relativeBundlePath)(from, to, {\n    leadingDotSlash: false\n  }));\n}\n\nfunction shouldUseRuntimeManifest(bundle) {\n  let env = bundle.env;\n  return !env.isLibrary && env.outputFormat === 'global' && env.isBrowser();\n}\n\nfunction getPublicBundleId(bundle) {\n  return bundle.id.slice(-16);\n}","\"use strict\";\n\n/* globals document:readonly */\nvar bundleURL = null;\n\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  let matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","\"use strict\";\n\nvar resolve = require('./bundle-manifest').resolve;\n\nmodule.exports = function (fromId, toId) {\n  return relative(dirname(resolve(fromId)), resolve(toId));\n};\n\nfunction dirname(_filePath) {\n  if (_filePath === '') {\n    return '.';\n  }\n\n  var filePath = _filePath[_filePath.length - 1] === '/' ? _filePath.slice(0, _filePath.length - 1) : _filePath;\n  var slashIndex = filePath.lastIndexOf('/');\n  return slashIndex === -1 ? '.' : filePath.slice(0, slashIndex);\n}\n\nfunction relative(from, to) {\n  if (from === to) {\n    return '';\n  }\n\n  var fromParts = from.split('/');\n\n  if (fromParts[0] === '.') {\n    fromParts.shift();\n  }\n\n  var toParts = to.split('/');\n\n  if (toParts[0] === '.') {\n    toParts.shift();\n  } // Find where path segments diverge.\n\n\n  var i;\n  var divergeIndex;\n\n  for (i = 0; (i < toParts.length || i < fromParts.length) && divergeIndex == null; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      divergeIndex = i;\n    }\n  } // If there are segments from \"from\" beyond the point of divergence,\n  // return back up the path to that point using \"..\".\n\n\n  var parts = [];\n\n  for (i = 0; i < fromParts.length - divergeIndex; i++) {\n    parts.push('..');\n  } // If there are segments from \"to\" beyond the point of divergence,\n  // continue using the remaining segments.\n\n\n  if (toParts.length > divergeIndex) {\n    parts.push.apply(parts, toParts.slice(divergeIndex));\n  }\n\n  return parts.join('/');\n}\n\nmodule.exports._dirname = dirname;\nmodule.exports._relative = relative;","import cubeTexture1 from 'url:/img/lcdm/cubes/1.jpg';\r\nimport cubeTexture2 from 'url:/img/lcdm/cubes/2.jpg';\r\nimport cubeTexture3 from 'url:/img/lcdm/cubes/3.jpg';\r\nimport cubeTexture4 from 'url:/img/lcdm/cubes/4.jpg';\r\nimport cubeTexture5 from 'url:/img/lcdm/cubes/5.jpg';\r\n\r\nlet scene , camera, canvas, renderer;\r\nlet grabPoint;\r\nlet cubes = [];\r\nlet interactable = [];\r\n\r\nconst mouse = new THREE.Vector2();\r\nconst raycaster = new THREE.Raycaster();\r\nlet physicsWorld;\r\nlet clock;\r\nlet AmmoLib;\r\nlet tmpTrans;\r\nlet tbv;\r\n\r\nlet linePositions = [0, 0, 0, /**/ 0,0,0];\r\nlet line;\r\n\r\nlet directionalLight;\r\n\r\nconst cubeSettings = [\r\n    {\r\n        elem: document.querySelector('.cube.is-1'),\r\n        pos: {x:0, y: 0, z: 0 },\r\n        rot: new THREE.Euler(30, 0, 0),\r\n        texture: cubeTexture1,\r\n        active: true\r\n    },\r\n    {\r\n        elem: document.querySelector('.cube.is-2'),\r\n        pos: {x:0, y: 0, z: 0 },\r\n        rot: new THREE.Euler(30, 0, 0),\r\n        texture: cubeTexture2,\r\n    },\r\n    {\r\n        elem: document.querySelector('.cube.is-3'),\r\n        pos: {x:0, y: 0, z: 0 },\r\n        rot: new THREE.Euler(30, 0, 0),\r\n        texture: cubeTexture3,\r\n    },\r\n    {\r\n        elem: document.querySelector('.cube.is-4'),\r\n        pos: {x:0, y: 0, z: 0 },\r\n        rot: new THREE.Euler(0, 0, 0),\r\n        texture: cubeTexture4,\r\n    },\r\n    {\r\n        elem: document.querySelector('.cube.is-5'),\r\n        pos: {x:0, y: 0, z: 0 },\r\n        rot: new THREE.Euler(0, 0, 0),\r\n        texture: cubeTexture5,\r\n        active: true\r\n    }\r\n]\r\n\r\nconst planElems = document.querySelectorAll('.shadow-panel');\r\n\r\nwindow.addEventListener('load', () => {\r\n    Ammo().then( function (ammo) {\r\n        AmmoLib = ammo;\r\n        tmpTrans = new AmmoLib.btTransform();\r\n        tbv = new AmmoLib.btVector3();\r\n\r\n        start();\r\n    } );\r\n});\r\n\r\nfunction getGameXY(bounds){\r\n    let x = bounds.x;\r\n    let y = bounds.y;\r\n\r\n    //get relative to document\r\n    x += window.pageXOffset;\r\n    y += window.pageYOffset;\r\n\r\n    //get relative to game axis\r\n    x = x + canvas.clientWidth / -2;\r\n    y = ( canvas.clientHeight / 2) - y;\r\n\r\n    //center\r\n    x += bounds.width / 2;\r\n    y -= bounds.height / 2;\r\n\r\n    return {x: x/camera.zoom, y: y/camera.zoom, height: bounds.height / camera.zoom, width: bounds.width / camera.zoom};\r\n}\r\n\r\nfunction updateCubeSettings(){\r\n    for(let i = 0; i < cubeSettings.length; i++){\r\n        const curCube = cubeSettings[i];\r\n        const e = curCube.elem;\r\n        if (!e) continue;\r\n        const bounds = getGameXY(e.getBoundingClientRect());\r\n\r\n        curCube.pos = new THREE.Vector3(bounds.x, bounds.y , 0);\r\n    }\r\n}\r\n\r\nfunction createAndAddCubesContainer(){\r\n    const element = document.querySelector('.puzzle');\r\n    const bounds = element.getBoundingClientRect();\r\n    const gameBounds = getGameXY(bounds);\r\n\r\n    const min_x = gameBounds.x;\r\n    const min_y = gameBounds.y;\r\n\r\n    const w = 0.2;\r\n\r\n    //Crystal\r\n    const planeMaterial = new THREE.MeshBasicMaterial({\r\n        color: 0xffffff,\r\n        opacity: 0.2,\r\n        transparent: true,\r\n    });\r\n    const planeGeometry = new THREE.PlaneBufferGeometry( gameBounds.width, gameBounds.height, 8, 8 );\r\n\r\n    const crystal = new THREE.Mesh( planeGeometry, planeMaterial );\r\n\r\n    crystal.position.set(min_x, min_y, 10);\r\n    crystal.name = \"NOCOLLIDE_CRYSTAL\";\r\n    scene.add(crystal);\r\n    interactable.push(crystal);\r\n\r\n    createBound(\"TOP_SHELF\",min_x, min_y - w/2 + gameBounds.height / 2, 0, w, gameBounds.width, 100, 0x9c9c9c);\r\n    createBound(\"BOTTOM_SHELF\",min_x, min_y + w/2 - gameBounds.height / 2, 0, w, gameBounds.width*1.1, 100, 0x9c9c9c);\r\n}\r\n\r\nfunction createAndAddShadowPlanes(){\r\n    const createShadowPlane = function (width, height, position, rotation, opacity = 0.5) {\r\n        const planeGeometry = new THREE.PlaneBufferGeometry( width, height, 32, 32 );\r\n        const planeMaterial =  new THREE.ShadowMaterial();\r\n\r\n        planeMaterial.opacity = opacity;\r\n\r\n        const plane = new THREE.Mesh( planeGeometry, planeMaterial );\r\n\r\n        plane.position.copy(position);\r\n        plane.rotation.copy(rotation);\r\n        plane.receiveShadow = true;\r\n\r\n        return plane;\r\n    }\r\n\r\n    const rot = new THREE.Euler(0, 0, 0);\r\n    for(let i = 0; i < planElems.length; i++) {\r\n        const e = planElems[i];\r\n        const b = e.getBoundingClientRect();\r\n\r\n        const pos = getGameXY(b);\r\n\r\n        pos.z = -1;\r\n        const shadowPlane = createShadowPlane(pos.width, pos.height, pos, rot);\r\n        scene.add(shadowPlane);\r\n    }\r\n}\r\n\r\nfunction init() {\r\n    clock = new THREE.Clock();\r\n\r\n    canvas = document.getElementById( 'c' );\r\n\r\n    renderer = new THREE.WebGLRenderer( { canvas: canvas, alpha: true } );\r\n\r\n    renderer.shadowMap.enabled = true;\r\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap; // default THREE.PCFShadowMap\r\n\r\n    camera = new THREE.OrthographicCamera( 0,0,0,0, 1, 2000 );\r\n\r\n    camera.position.z = 100;\r\n    camera.zoom = 100;\r\n\r\n    updateCameraSize();\r\n\r\n    updateCubeSettings();\r\n\r\n    scene = new THREE.Scene();\r\n    scene.add( new THREE.AmbientLight( 0x505050 ) );\r\n\r\n    directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );\r\n    directionalLight.position.set( -5, -5, 30 );\r\n    directionalLight.castShadow = true;\r\n    directionalLight.shadow.camera = camera.clone();\r\n    scene.add( directionalLight );\r\n\r\n    directionalLight.shadow.mapSize.width = directionalLight.shadow.mapSize.height = 1024;\r\n\r\n    const lineGeometry = new THREE.BufferGeometry();\r\n\r\n    linePositions = new Float32Array( 2 * 3 ); // 3 vertices per point\r\n    lineGeometry.setAttribute( 'position', new THREE.BufferAttribute( linePositions, 3 ) );\r\n    lineGeometry.setDrawRange( 0, 2 );\r\n\r\n    line = new THREE.Line( lineGeometry,  new THREE.LineBasicMaterial( { color: 0xffffff , linewidth: scaleByPixelRatio(2)}) );\r\n\r\n    scene.add( line );\r\n\r\n    const geometry = new THREE.BoxBufferGeometry( 1, 1, 1 );\r\n\r\n    grabPoint = new THREE.Mesh( new THREE.SphereGeometry( 1, 16, 16 ), new THREE.MeshLambertMaterial( { color: 0xffffff } ) );\r\n    grabPoint.scale.set(0.1, 0.1,0.1);\r\n\r\n    grabPoint.visible = false;\r\n\r\n    scene.add(grabPoint);\r\n\r\n    function createCube(quat, scale, pos, i, mass, textureUrl) {\r\n        const texture = new THREE.TextureLoader().load(textureUrl);\r\n        const object = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({map: texture}));\r\n\r\n        object.position.set(pos.x, pos.y, pos.z);\r\n        object.scale.set(scale.x, scale.y, scale.z);\r\n        object.quaternion.set(quat.x, quat.y, quat.z, quat.w);\r\n\r\n        let transform = new AmmoLib.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new AmmoLib.btVector3(pos.x, pos.y, pos.z));\r\n        transform.setRotation(new AmmoLib.btQuaternion(quat.x, quat.y, quat.z, quat.w));\r\n\r\n        let motionState = new AmmoLib.btDefaultMotionState(transform);\r\n\r\n        let colShape = new AmmoLib.btBoxShape(new AmmoLib.btVector3(scale.x * 0.5, scale.y * 0.5, scale.z * 0.5));\r\n\r\n        let localInertia = new AmmoLib.btVector3(0, 0, 0);\r\n\r\n        colShape.calculateLocalInertia(mass, localInertia);\r\n\r\n        let rbInfo = new AmmoLib.btRigidBodyConstructionInfo(mass, motionState, colShape, localInertia);\r\n        let body = new AmmoLib.btRigidBody(rbInfo);\r\n\r\n        body.forceActivationState(2);\r\n\r\n        physicsWorld.addRigidBody(body);\r\n        object.name = \"cube\" + i;\r\n        object.userData.physicsBody = body;\r\n        object.castShadow = true;\r\n\r\n        return object;\r\n    }\r\n\r\n    for ( let i = 0; i < cubeSettings.length; i ++ ) {\r\n        const config = cubeSettings[i] || {pos: undefined, rot: undefined};\r\n\r\n        let pos = config.pos;\r\n        let rot = config.rot || new THREE.Euler(0, 0, 0);\r\n        let scale = {x: 1, y:1, z:1};\r\n        const quat = new THREE.Quaternion();\r\n        let mass = 10;\r\n\r\n        quat.setFromEuler(rot);\r\n\r\n        const size = document.querySelector('.cube').getBoundingClientRect().width / camera.zoom;\r\n\r\n        scale.x = size;\r\n        scale.y = size;\r\n        scale.z = size;\r\n\r\n        if (!pos) {\r\n            pos = {};\r\n            pos.x = -4 + i * (size + .1);\r\n            pos.y = 2;\r\n            pos.z = 0;\r\n        }\r\n\r\n        const object = createCube(quat, scale, pos, i, mass, config.texture);\r\n\r\n        if (config.active)\r\n            object.userData.physicsBody.activate();\r\n        object.userData.domElem = config.elem;\r\n\r\n        scene.add(object);\r\n        cubes.push( object );\r\n        interactable.push( object );\r\n    }\r\n\r\n    createAndAddCubesContainer();\r\n\r\n    createAndAddShadowPlanes();\r\n\r\n    window.lastWidth = window.innerWidth;\r\n\r\n    //HACK: Reloads page on resize... Too hard to recreate physics+render worlds u.u\"\r\n    window.addEventListener( 'resize', () => {\r\n        if (window.lastWidth === window.innerWidth){\r\n            updateSize();\r\n            return;\r\n        }\r\n\r\n        if (window.RT) clearTimeout(window.RT);\r\n        window.RT = setTimeout(() => window.location.reload(false), 500);\r\n    }, false );\r\n\r\n    window.addEventListener( 'mousemove', onMouseMove, false );\r\n    window.addEventListener( 'dragstart', onMouseMove, false );\r\n    window.addEventListener( 'mousedown', onMouseDown, {passive: false} );\r\n    window.addEventListener( 'mouseup', onMouseCancel, false );\r\n\r\n    window.addEventListener( 'touchstart', onMouseDown, {passive: false} );\r\n    window.addEventListener( 'touchend', onMouseCancel, false );\r\n    window.addEventListener( 'touchmove', onMouseMove, false );\r\n}\r\n\r\nfunction createBound(name, x, y, z, height, width, depth, color, friction = 1){\r\n    const groundShape = new AmmoLib.btBoxShape(new AmmoLib.btVector3(width/2, height/2, depth/2));\r\n    const groundTransform = new AmmoLib.btTransform();\r\n    groundTransform.setIdentity();\r\n    groundTransform.setOrigin(new AmmoLib.btVector3(x, y, z));\r\n\r\n    (function() {\r\n        const localInertia = new AmmoLib.btVector3(0, 0, 0);\r\n        const myMotionState = new AmmoLib.btDefaultMotionState(groundTransform);\r\n        const rbInfo = new AmmoLib.btRigidBodyConstructionInfo(0, myMotionState, groundShape, localInertia);\r\n        const body = new AmmoLib.btRigidBody(rbInfo);\r\n\r\n        body.setCollisionFlags(1 );\r\n        body.setFriction(friction);\r\n        physicsWorld.addRigidBody(body);\r\n\r\n        const geometry = new THREE.BoxBufferGeometry( 1, 1, 1 );\r\n        const object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: color } ) );\r\n\r\n        object.scale.set(width, height, depth);\r\n\r\n        object.position.x = x;\r\n        object.position.y = y;\r\n        object.position.z = z;\r\n\r\n        object.name = name;\r\n        object.userData.body = body;\r\n\r\n        scene.add(object);\r\n    })();\r\n}\r\n\r\nfunction removeEntity (name) {\r\n    const selectedObject = scene.getObjectByName(name);\r\n    if (selectedObject) {\r\n        physicsWorld.removeRigidBody(selectedObject.userData.body);\r\n        scene.remove(selectedObject);\r\n    }\r\n}\r\n\r\nfunction CreateBounds(){\r\n    const min_x = camera.left / camera.zoom;\r\n    const max_x = camera.right / camera.zoom;\r\n    const min_y = camera.bottom / camera.zoom;\r\n    const max_y = camera.top / camera.zoom;\r\n\r\n    let w = 2;\r\n\r\n    removeEntity(\"TOP\");\r\n    removeEntity(\"BOTTOM\");\r\n    removeEntity(\"LEFT\");\r\n    removeEntity(\"RIGHT\");\r\n\r\n    createBound(\"TOP\",min_x - w/2, 0, 0, (max_y - min_y), w, 100, 0xffffff);\r\n    createBound(\"BOTTOM\", max_x + w/2, 0, 0, (max_y - min_y), w, 100, 0x0000ff);\r\n\r\n    createBound(\"LEFT\",0, max_y + w/2, 0, w, (max_x - min_x), 100, 0xff0000);\r\n    createBound(\"RIGHT\",0, min_y - w/2, 0, w, (max_x - min_x), 100, 0x00ff00);\r\n}\r\n\r\nfunction updateCameraSize(){\r\n    camera.left = canvas.clientWidth / - 2;\r\n    camera.right = canvas.clientWidth / 2;\r\n    camera.top = canvas.clientHeight / 2;\r\n    camera.bottom = canvas.clientHeight / - 2;\r\n    camera.updateProjectionMatrix();\r\n}\r\n\r\nfunction resizeRendererToDisplaySize(renderer) {\r\n    const r = renderer.domElement;\r\n    const width  = canvas.clientWidth;\r\n    const height = canvas.clientHeight;\r\n    const needResize = r.width !== width || r.height !== height;\r\n\r\n    if (needResize)\r\n        renderer.setSize(width, height, false);\r\n\r\n    return needResize;\r\n}\r\n\r\nfunction updateSize() {\r\n    if (resizeRendererToDisplaySize(renderer)) {\r\n        updateCubeSettings();\r\n        updateCameraSize();\r\n        CreateBounds();\r\n    }\r\n}\r\n\r\nfunction animate() {\r\n    render();\r\n    requestAnimationFrame( animate );\r\n}\r\n\r\nlet intersection = undefined;\r\nlet constraint;\r\nlet pickedBody;\r\n\r\nconst mousePickClamping = 30;\r\n\r\nfunction onMouseDown( event ) {\r\n    updateMouse(event);\r\n    updateIntersection(mouse);\r\n\r\n    if (!intersection) return;\r\n\r\n    event.preventDefault();\r\n\r\n    const inter = intersection;\r\n    const obj = inter.object;\r\n\r\n    pickedBody = obj.userData.physicsBody;\r\n\r\n    pickedBody.activate(true);\r\n\r\n    const localPoint = obj.worldToLocal(inter.point)\r\n    const localPivot = new AmmoLib.btVector3(localPoint.x * obj.scale.x, localPoint.y * obj.scale.y, localPoint.z * obj.scale.z);\r\n    constraint = new AmmoLib.btPoint2PointConstraint(pickedBody, localPivot);\r\n    physicsWorld.addConstraint(constraint, true);\r\n\r\n    constraint.m_setting.m_impulseClamp = mousePickClamping;\r\n    constraint.m_setting.m_tau = 0.001;\r\n\r\n    grabPoint.visible = true;\r\n    grabPoint.position.copy(inter.point);\r\n    grabPoint.parent = obj;\r\n}\r\n\r\nfunction onMouseCancel( event ) {\r\n    if (constraint){\r\n        physicsWorld.removeConstraint(constraint);\r\n        constraint = undefined;\r\n        pickedBody.setActivationState(1);\r\n        pickedBody = undefined;\r\n        grabPoint.visible = false;\r\n    }\r\n}\r\n\r\nfunction updateMouse(event){\r\n    const touchEv = event.touches && event.touches[0];\r\n    const changedTouchEv = event.changedTouches && event.changedTouches[0];\r\n    const touch = touchEv || changedTouchEv || event;\r\n\r\n    const documentBounds = document.documentElement.getBoundingClientRect();\r\n\r\n    mouse.x = ( touch.pageX / documentBounds.width ) * 2 - 1;\r\n    mouse.y = - ( touch.pageY / documentBounds.height ) * 2 + 1;\r\n\r\n    mouse.nonPageX = ( touch.clientX / documentBounds.width ) * 2 - 1;\r\n    mouse.nonPageY = - ( touch.clientY / documentBounds.height ) * 2 + 1;\r\n}\r\n\r\nfunction updateIntersection(mouse){\r\n    raycaster.setFromCamera( mouse, camera );\r\n\r\n    const newIntersections = raycaster.intersectObjects( interactable );\r\n\r\n    intersection = undefined;\r\n\r\n    if (newIntersections.length > 0 && !newIntersections[0].object.name.startsWith(\"NOCOLLIDE\")){\r\n        intersection = newIntersections[0];\r\n    }\r\n\r\n    if (intersection){\r\n        canvas.style.pointerEvents = 'all';\r\n        canvas.style.cursor = 'pointer';\r\n    }else if (!constraint){\r\n        canvas.style.pointerEvents = 'none';\r\n        canvas.style.cursor = 'auto';\r\n    }\r\n}\r\n\r\nfunction onMouseMove( event ) {\r\n    updateMouse(event);\r\n    updateIntersection(mouse);\r\n\r\n    if (constraint) {\r\n        let v = new THREE.Vector3( mouse.x, mouse.y, -1 )\r\n        let {x, y, z} = v.unproject(camera);\r\n\r\n        const oldPivotInB = constraint.getPivotInB();\r\n\r\n        oldPivotInB.setX(x);\r\n        oldPivotInB.setY(y);\r\n\r\n        canvas.style.cursor = 'move';\r\n\r\n        if (mouse.nonPageY > .8){\r\n            window.scroll(window.scrollX, window.scrollY - 10);\r\n            updateMouse(event);\r\n            updateIntersection(mouse);\r\n        }\r\n    }\r\n}\r\n\r\nlet frame_counter = 0;\r\nlet first_time = true;\r\n\r\nfunction render(){\r\n    const deltaTime = clock.getDelta();\r\n\r\n    const time = Date.now() * 0.0005;\r\n\r\n    directionalLight.position.y = Math.cos( time * 3 ) * .75 - 5;\r\n\r\n    ClampPositions();\r\n\r\n    if (constraint) {\r\n        if (first_time){\r\n            ga('send', {\r\n                hitType: 'event',\r\n                eventCategory: 'LCDM',\r\n                eventAction: 'start'\r\n            });\r\n\r\n            first_time = false;\r\n        }\r\n        let v = new THREE.Vector3( mouse.x, mouse.y, -1 )\r\n        let {x, y, z} = v.unproject(camera);\r\n        let grabPointPos = new THREE.Vector3();\r\n\r\n        grabPointPos.setFromMatrixPosition(grabPoint.matrixWorld);\r\n\r\n        let i = 0;\r\n\r\n        linePositions[i++] = grabPointPos.x;\r\n        linePositions[i++] = grabPointPos.y;\r\n        linePositions[i++] = grabPointPos.z;\r\n\r\n        linePositions[i++] = x;\r\n        linePositions[i++] = y;\r\n        linePositions[i++] = z;\r\n\r\n        line.geometry.attributes.position.needsUpdate = true;\r\n        line.geometry.computeBoundingSphere();\r\n        line.visible = true;\r\n    }else{\r\n        line.visible = false;\r\n    }\r\n\r\n    updatePhysics( deltaTime );\r\n\r\n    if (!solved){\r\n        solved = CheckSolution();\r\n\r\n        if (solved) {\r\n            ga('send', {\r\n                hitType: 'event',\r\n                eventCategory: 'LCDM',\r\n                eventAction: 'solved'\r\n            });\r\n            PlaySolvedMagic();\r\n        }\r\n    }else{\r\n        if (frame_counter++ % 300 === 0) {\r\n            for (let i = 0; i < cubes.length; i++) {\r\n                const body = cubes[i].userData.physicsBody;\r\n                const force = Math.random()*50;\r\n                const v = new THREE.Vector3(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5);\r\n                v.normalize();\r\n                v.multiplyScalar(force);\r\n\r\n                const [vx, vy, vz] = [v.x, v.y, 0];\r\n\r\n                body.activate();\r\n                body.applyCentralImpulse(new AmmoLib.btVector3(vx, vy, vz));\r\n            }\r\n        }\r\n        window.fluidsMovePointers(PreparePointers());\r\n    }\r\n\r\n    renderer.render( scene, camera );\r\n}\r\n\r\nwindow.solve = () => {solved = true; PlaySolvedMagic()};\r\n\r\nlet solved = false;\r\n\r\nfunction PreparePointers(){\r\n    const cubePointers = [];\r\n\r\n    for(let i = 0 ; i < cubes.length; i++){\r\n        const cube = cubes[i];\r\n        const pos = cube.position;\r\n\r\n        cubePointers.push({\r\n            x: (pos.x * camera.zoom + camera.right),\r\n            y: (pos.y * camera.zoom + camera.top),\r\n            identifier: cube.name\r\n        });\r\n    }\r\n\r\n    return cubePointers;\r\n}\r\n\r\nfunction PlaySolvedMagic(){\r\n    removeEntity(\"TOP_SHELF\");\r\n    removeEntity(\"BOTTOM_SHELF\");\r\n    removeEntity(\"NOCOLLIDE_CRYSTAL\");\r\n    window.vantabg.destroy();\r\n    window.enableFluids();\r\n    const cubesPointers = PreparePointers();\r\n    window.fluidsStartPointers(cubesPointers);\r\n    gravity = new AmmoLib.btVector3(0, 0, 0);\r\n}\r\n\r\nfunction CheckSolution(){\r\n    const element = document.querySelector('.puzzle');\r\n    const bounds = element.getBoundingClientRect();\r\n    const gameBounds = getGameXY(bounds);\r\n\r\n    const min_x = gameBounds.x - gameBounds.width / 2;\r\n    const max_x = gameBounds.x + gameBounds.width / 2;\r\n    const min_y = gameBounds.y - gameBounds.height / 2;\r\n    const max_y = gameBounds.y + gameBounds.height / 2;\r\n\r\n    const solution = \"12345\";\r\n    const trySol = [];\r\n\r\n    for(let i = 0 ; i < cubes.length; i++){\r\n        const cube = cubes[i];\r\n\r\n        if (cube.position.x > max_x || cube.position.x < min_x){\r\n            return false;\r\n        }\r\n        if (cube.position.y > max_y || cube.position.y < min_y){\r\n            return false;\r\n        }\r\n        trySol.push([i+1, cube.position.x])\r\n    }\r\n\r\n    trySol.sort((a, b) => a[1] - b[1]);\r\n    const proposedSol = trySol.map((e) => e[0].toString()).join(\"\");\r\n\r\n    return solution === proposedSol;\r\n}\r\n\r\nfunction ClampPositions(){\r\n    for(let i = 0; i < cubes.length; i++){\r\n        const obj = cubes[i];\r\n        const body = obj.userData.physicsBody;\r\n\r\n        const transform = body.getCenterOfMassTransform();\r\n        const position = obj.position;\r\n\r\n        position.z = 0;\r\n        position.x = Math.min(Math.max(camera.left / camera.zoom, position.x), camera.right / camera.zoom);\r\n        position.y = Math.min(Math.max(camera.bottom / camera.zoom, position.y), camera.top / camera.zoom);\r\n\r\n        transform.setOrigin( new AmmoLib.btVector3( position.x, position.y, position.z ) );\r\n\r\n        body.setCenterOfMassTransform(transform);\r\n    }\r\n}\r\n\r\nlet gravity = undefined;\r\n\r\nfunction setupPhysicsWorld(){\r\n    let collisionConfiguration  = new AmmoLib.btDefaultCollisionConfiguration(),\r\n        dispatcher              = new AmmoLib.btCollisionDispatcher(collisionConfiguration),\r\n        overlappingPairCache    = new AmmoLib.btDbvtBroadphase(),\r\n        solver                  = new AmmoLib.btSequentialImpulseConstraintSolver();\r\n\r\n    if (!gravity)\r\n        gravity = new AmmoLib.btVector3(0, -9.8, 0);\r\n\r\n    physicsWorld = new AmmoLib.btDiscreteDynamicsWorld(dispatcher, overlappingPairCache, solver, collisionConfiguration);\r\n    physicsWorld.setGravity(gravity);\r\n}\r\n\r\nfunction start(){\r\n    setupPhysicsWorld();\r\n\r\n    init();\r\n    updateSize();\r\n    CreateBounds();\r\n    animate();\r\n}\r\n\r\nfunction updatePhysics( deltaTime ){\r\n    // Update gravity\r\n    physicsWorld.setGravity(gravity);\r\n    // Step world\r\n    physicsWorld.stepSimulation( deltaTime );\r\n\r\n    // Update rigid bodies\r\n    for ( let i = 0; i < cubes.length; i++ ) {\r\n        let objThree = cubes[ i ];\r\n        let objAmmo = objThree.userData.physicsBody;\r\n\r\n        let ms = objAmmo.getMotionState();\r\n        if ( ms ) {\r\n            ms.getWorldTransform( tmpTrans );\r\n            let p = tmpTrans.getOrigin();\r\n            let q = tmpTrans.getRotation();\r\n            objThree.position.set( p.x(), p.y(), p.z() );\r\n            objThree.quaternion.set( q.x(), q.y(), q.z(), q.w() );\r\n        }\r\n    }\r\n}\r\n\r\nconst burger = document.querySelector('#navbar-burger-id');\r\n\r\nburger.addEventListener('click', function(){\r\n    if (burger.classList.contains('is-active')){\r\n        gravity = new AmmoLib.btVector3(0, -9.8, 0);\r\n        for(let i = 0; i < cubes.length; i++)\r\n            cubes[i].userData.physicsBody.activate(true);\r\n    }else{\r\n        if (!solved) return;\r\n        gravity = new AmmoLib.btVector3(0, 0, 0);\r\n    }\r\n}, false)\r\n\r\nfunction scaleByPixelRatio (input) {\r\n    let pixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return Math.floor(input * pixelRatio);\r\n}"]}